# This is a basic workflow to help you get started with Actions

name: CI

#on: [push]
#
#jobs:
#  build:
#
#    runs-on: macos-latest
#
#    steps:
#      - uses: actions/checkout@v3
#      - run: fastlane beta
#        env:
#          MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}
    
    on:
    push:
    branches: [ main ]
    pull_request:
    branches: [ main ]
    
    # Allows you to run this workflow manually from the Actions a tab
    workflow_dispatch:

jobs:
    deploy:
    name: Deploying to Testflight
    runs-on: macOS-latest
    
    steps:
        - name: Checkout repository
        uses: actions/checkout@v1
        
        - name: Deploy iOS Beta to TestFlight via Fastlane
        uses: maierj/fastlane-action@v1.4.0
        with:
            lane: beta
        env:
            APP_STORE_CONNECT_TEAM_ID: '${{ secrets.APP_STORE_CONNECT_TEAM_ID }}'
            DEVELOPER_APP_ID: '${{ secrets.DEVELOPER_APP_ID }}'
            DEVELOPER_APP_IDENTIFIER: '${{ secrets.DEVELOPER_APP_IDENTIFIER }}'
            DEVELOPER_PORTAL_TEAM_ID: '${{ secrets.DEVELOPER_PORTAL_TEAM_ID }}'
            FASTLANE_APPLE_ID: '${{ secrets.FASTLANE_APPLE_ID }}'
            FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD: '${{ secrets.FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD }}'
            MATCH_PASSWORD: '${{ secrets.MATCH_PASSWORD }}'
            GIT_AUTHORIZATION: '${{ secrets.GIT_AUTHORIZATION }}'
            PROVISIONING_PROFILE_SPECIFIER: '${{ secrets.PROVISIONING_PROFILE_SPECIFIER }}'
            TEMP_KEYCHAIN_PASSWORD: '${{ secrets.TEMP_KEYCHAIN_PASSWORD }}'
            TEMP_KEYCHAIN_USER: '${{ secrets.TEMP_KEYCHAIN_USER }}'
            APPLE_KEY_ID: '${{ secrets.APPLE_KEY_ID }}'
            APPLE_ISSUER_ID: '${{ secrets.APPLE_ISSUER_ID }}'
            APPLE_KEY_CONTENT: '${{ secrets.APPLE_KEY_CONTENT }}'

## Controls when the workflow will run
#on:
#  # Triggers the workflow on push or pull request events but only for the main branch
#  push:
#    branches: [ main ]
#  pull_request:
#    branches: [ main ]
#
#  # Allows you to run this workflow manually from the Actions tab
#  workflow_dispatch:
#
## A workflow run is made up of one or more jobs that can run sequentially or in parallel
#jobs:
#  # This workflow contains a single job called "build"
#  build:
#    # The type of runner that the job will run on
#    runs-on: ubuntu-latest
#
#    # Steps represent a sequence of tasks that will be executed as part of the job
#    steps:
#      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
#      - uses: actions/checkout@v3
#
#      # Runs a single command using the runners shell
#      - name: Run a one-line script
#        run: echo Hello, world!
#
#      # Runs a set of commands using the runners shell
#      - name: Run a multi-line script
#        run: |
#          echo Add other actions to build,
#          echo test, and deploy your project.
