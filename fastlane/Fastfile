

default_platform(:ios)

platform :ios do
before_all do
    ENV["FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD"] = "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"
  end
  
  desc "Push a new beta build to TestFlight"
  lane :beta do
  
   
    clear_derived_data
    app_store_connect_api_key()

  match(
    type: 'appstore',
    app_identifier: ["com.CICD"],
    readonly: true
  )

    get_certificates
    get_provisioning_profile
  
      sync_code_signing(type: "appstore")
      
    setup_ci
    increment_build_number(xcodeproj: "GitHubCICD.xcodeproj")
    build_app
    upload_to_testflight(skip_waiting_for_build_processing: true)
    
  end
end
